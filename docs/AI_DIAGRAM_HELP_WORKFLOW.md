# ğŸ¤– AI Diagram Help - Complete Workflow Design

## ğŸ“Š Scenarios & Solutions

---

### **Scenario 1: Text Selected in Editor â†’ Open Diagram**

#### What Happens:
1. User selects text in editor
2. Opens diagram dialog
3. âœ… **Blue banner shows**: "Selected text detected"
4. User selects diagram type (e.g., Flowchart)

#### When User Clicks "AI Diagram Help":
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI Diagram Assistant                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â„¹ï¸ Using selected text as context:             â”‚
â”‚  "Mobile App Development Process..."            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  What do you want to do?                        â”‚
â”‚                                                  â”‚
â”‚  âš¡ Quick Actions:                               â”‚
â”‚  [ Generate Flowchart from this text ]          â”‚
â”‚  [ Extract process steps as diagram ]           â”‚
â”‚  [ Convert to visual workflow ]                 â”‚
â”‚  [ Create structure diagram ]                   â”‚
â”‚                                                  â”‚
â”‚  âœï¸ Or describe what you want:                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ "Create a flowchart showing the      â”‚      â”‚
â”‚  â”‚  mobile app development stages..."    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                  â”‚
â”‚  [ Cancel ]              [ Generate Diagram ]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Result:**
- AI analyzes selected text
- Generates appropriate diagram code
- Shows in code editor for preview/editing

---

### **Scenario 2: No Text Selected â†’ Open Diagram**

#### What Happens:
1. User opens diagram dialog (no selection)
2. User selects diagram type (e.g., Sequence Diagram)
3. Empty code template shown

#### When User Clicks "AI Diagram Help":
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI Diagram Assistant                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Create a Sequence Diagram                      â”‚
â”‚                                                  â”‚
â”‚  âš¡ Quick Starts:                                â”‚
â”‚  [ Simple login flow ]                           â”‚
â”‚  [ API request/response ]                        â”‚
â”‚  [ User authentication ]                         â”‚
â”‚  [ Payment process ]                             â”‚
â”‚                                                  â”‚
â”‚  âœï¸ Or describe your diagram:                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Example: "User logs in, system       â”‚      â”‚
â”‚  â”‚  verifies credentials, sends token,  â”‚      â”‚
â”‚  â”‚  user accesses dashboard"             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                  â”‚
â”‚  ğŸ“ Or paste content to convert:                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ [Paste text, bullet points, etc.]    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                  â”‚
â”‚  [ Cancel ]              [ Generate Diagram ]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Result:**
- AI generates diagram from description
- Or converts pasted content
- Or uses quick start template

---

### **Scenario 3: User Already Has Code â†’ Clicks AI Help**

#### What Happens:
User has existing diagram code, wants to improve it

#### AI Help Dialog:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI Diagram Assistant                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Current diagram detected âœ“                     â”‚
â”‚                                                  â”‚
â”‚  âš¡ Quick Actions:                               â”‚
â”‚  [ Improve this diagram ]                        â”‚
â”‚  [ Add more detail ]                             â”‚
â”‚  [ Simplify structure ]                          â”‚
â”‚  [ Fix syntax errors ]                           â”‚
â”‚  [ Change diagram type ]                         â”‚
â”‚                                                  â”‚
â”‚  âœï¸ Or tell me what to change:                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ "Add error handling steps"            â”‚      â”‚
â”‚  â”‚ "Make it more detailed"               â”‚      â”‚
â”‚  â”‚ "Add 3 more nodes for validation"    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                  â”‚
â”‚  [ Cancel ]              [ Apply Changes ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Result:**
- AI modifies existing code
- Shows changes in code editor
- User can preview

---

## ğŸ”„ AI Generation Flow

### **Step 1: User Clicks "Generate"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Generating diagram...                        â”‚
â”‚                                                  â”‚
â”‚  [â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60%                         â”‚
â”‚                                                  â”‚
â”‚  Analyzing your request...                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Step 2: AI Returns Result**

Dialog closes, code editor updates with generated code:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Code Editor (80%)                              â”‚
â”‚                                                 â”‚
â”‚  flowchart TD                                   â”‚
â”‚    A[Start] --> B{Login?}                      â”‚
â”‚    B -->|Yes| C[Dashboard]                     â”‚
â”‚    B -->|No| D[Signup]                         â”‚
â”‚                                                 â”‚
â”‚  âœ¨ AI Generated this diagram!                  â”‚
â”‚  Not quite right? Click AI Help to refine      â”‚
â”‚                                                 â”‚
â”‚  [âœ¨ AI Diagram Help]    [ğŸ‘ï¸ Show Preview]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âŒ User Doesn't Like Result

### **Option 1: Refine with AI**
1. Click "AI Diagram Help" again
2. Dialog opens with new options:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Refine Diagram                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš¡ Quick Fixes:                                 â”‚
â”‚  [ Make it more complex ]                        â”‚
â”‚  [ Make it simpler ]                             â”‚
â”‚  [ Add more steps ]                              â”‚
â”‚  [ Change layout direction ]                     â”‚
â”‚  [ Try different style ]                         â”‚
â”‚                                                  â”‚
â”‚  âœï¸ What's wrong with it?                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ "Add authentication steps between    â”‚      â”‚
â”‚  â”‚  login and dashboard"                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                  â”‚
â”‚  [ Cancel ]              [ Regenerate ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Option 2: Manual Edit**
- User directly edits code in editor
- Can toggle preview to see changes
- Full control

### **Option 3: Start Over**
- Select different diagram type from left
- Start fresh with new template

---

## âœ… User Likes Result

### **Option 1: Insert Immediately**
1. Code looks good
2. Click "Insert Diagram" button
3. âœ… Inserted into document!

### **Option 2: Make Small Tweaks First**
1. AI generated good base
2. User manually tweaks (change labels, colors, etc.)
3. Toggle preview to verify
4. Click "Insert Diagram"

### **Option 3: Ask AI for Minor Changes**
1. Like it overall, but want one small change
2. Click "AI Diagram Help"
3. Quick request: "Add a timeout step"
4. AI makes small modification
5. Insert

---

## ğŸ¨ User Wants Changes Before Inserting

### **Flow:**
```
1. AI generates â†’ Code in editor
   â†“
2. User edits manually OR asks AI for changes
   â†“
3. Click "Show Preview" â†’ See how it looks
   â†“
4. Not satisfied? â†’ Back to step 2
   â†“
5. Satisfied? â†’ Click "Insert Diagram"
```

### **Key Features:**
- âœ… **Iterative**: Can refine multiple times
- âœ… **Hybrid**: AI + manual editing
- âœ… **Preview**: Always see before inserting
- âœ… **Non-destructive**: Original text unchanged until insert

---

## ğŸ”§ Technical Implementation

### **AI Help Button Opens Modal**
```typescript
const handleAIHelp = () => {
  setShowAIModal(true);
  
  // Pass context
  setAIContext({
    selectedText: selectedText,           // From editor
    currentCode: editableCode,            // Current diagram
    diagramType: selectedTemplate.type,   // Flowchart, Sequence, etc.
    hasExistingCode: editableCode.trim() !== selectedTemplate.code
  });
};
```

### **AI Modal Component**
```typescript
<AIAssistantModal
  isOpen={showAIModal}
  onClose={() => setShowAIModal(false)}
  context={aiContext}
  onGenerate={(generatedCode) => {
    setEditableCode(generatedCode);
    setShowAIModal(false);
    setShowPreview(true); // Auto-show preview
  }}
/>
```

### **AI Service Call**
```typescript
const generateDiagram = async (prompt: string, context: AIContext) => {
  const systemPrompt = `You are a Mermaid diagram expert.
  Generate ${context.diagramType} diagram code.
  ${context.selectedText ? `Based on this text: ${context.selectedText}` : ''}
  ${context.currentCode ? `Modify this existing diagram: ${context.currentCode}` : ''}
  Return ONLY mermaid code, no explanations.`;

  const result = await AIService.generateContent(
    prompt,
    { systemPrompt, maxTokens: 500 }
  );
  
  return result;
};
```

---

## ğŸ¯ User Experience Goals

### **1. Smart Context Detection**
- âœ… Auto-detect selected text
- âœ… Know if code exists
- âœ… Understand diagram type

### **2. Multiple Entry Points**
- âœ… Quick action buttons (common patterns)
- âœ… Natural language description
- âœ… Paste content to convert

### **3. Iterative Refinement**
- âœ… Easy to regenerate
- âœ… Can make small changes
- âœ… Keep trying until satisfied

### **4. Always Reviewable**
- âœ… See code before inserting
- âœ… Preview rendering
- âœ… Edit manually if needed

### **5. Non-Destructive**
- âœ… Original text unchanged
- âœ… Can cancel anytime
- âœ… Multiple attempts allowed

---

## ğŸ“ Conversation Flow Examples

### **Example 1: From Scratch**
```
User: [Opens diagram, selects Flowchart, clicks AI Help]
Modal: "Describe your diagram:"
User: "User login process with error handling"
AI: [Generates flowchart with login steps, success/error paths]
User: [Previews] "Looks good!" [Inserts]
```

### **Example 2: From Selected Text**
```
User: [Selects text about mobile app dev, opens diagram]
Banner: "Selected text detected"
User: [Clicks AI Help]
Modal: Quick Action: "Generate Flowchart from this text"
User: [Clicks quick action]
AI: [Generates diagram from text structure]
User: [Previews, manually adds one step, inserts]
```

### **Example 3: Refinement**
```
User: [AI generates diagram]
User: "Hmm, too simple" [Clicks AI Help again]
Modal: "What's wrong with it?"
User: "Add 3 more validation steps between login and dashboard"
AI: [Modifies diagram to add steps]
User: [Previews] "Perfect!" [Inserts]
```

---

## ğŸš€ Next Steps for Implementation

### **Phase 1: Basic AI Modal**
1. Create `AIAssistantModal.tsx`
2. Add prompt input
3. Quick action buttons
4. Connect to AI service

### **Phase 2: Context Detection**
1. Pass selected text
2. Pass current code
3. Detect diagram type

### **Phase 3: Refinement Flow**
1. "Regenerate" option
2. "Modify" option
3. Show diff/changes

### **Phase 4: Quick Actions**
1. Common diagram templates
2. Pattern library
3. One-click generation

---

## ğŸ’¡ Key Decisions Needed

1. **Modal or Inline?**
   - âœ… Modal (like Smart AI Modal in editor)
   - Focused experience
   - Don't lose diagram context

2. **Auto-preview after generation?**
   - âœ… Yes! Show preview automatically
   - User wants to see result immediately

3. **Keep AI modal open after generation?**
   - âŒ No, close and show result
   - User can reopen if not satisfied

4. **Show "AI Generated" badge?**
   - âœ… Yes, small hint below code
   - Encourages refinement if needed

5. **Limit regeneration attempts?**
   - âŒ No limit
   - Let user iterate freely

---

## ğŸ‰ End Result

**User gets:**
- ğŸ¤– AI-powered diagram generation
- ğŸ“ Natural language interface
- ğŸ”„ Iterative refinement
- ğŸ‘ï¸ Always preview before insert
- âœï¸ Can manually edit
- âš¡ Quick start templates
- ğŸ¯ Context-aware suggestions

**Perfect workflow for both AI beginners and power users!**

